import{w as f,x as w,y as U,z as D,D as g,e as v,T as u,F as q,G as y}from"./vendor-firebase-BLqY7lrF.js";import{$ as d,a0 as c}from"./index-B8M4Gl1o.js";async function $(t){const a=t||d.currentUser?.uid;if(!a)throw new Error("Usuário não autenticado");const o=f(c,"alunos",a,"estudos"),s=U(o,D("data","desc"));return(await w(s)).docs.slice(0,200).map(e=>({id:e.id,...e.data()}))}async function x(t){const a=t||d.currentUser?.uid;if(!a)throw new Error("Usuário não autenticado");const o=f(c,"alunos",a,"simulados"),s=U(o,D("data","desc"));return(await w(s)).docs.slice(0,100).map(e=>({id:e.id,...e.data()}))}async function z(t){const a=t||d.currentUser?.uid;if(!a)throw new Error("Usuário não autenticado");const o=f(c,"alunos",a,"metas"),s=U(o,D("dataFim","asc"));return(await w(s)).docs.map(e=>({id:e.id,...e.data()}))}async function B(t){const a=d.currentUser?.uid;if(!a)throw new Error("Usuário não autenticado");const o=f(c,"alunos",a,"planosAcao");return(await w(o)).docs.map(e=>{const m=e.data();return{id:e.id,...m,createdAt:m.createdAt||m.criadoEm||null}}).sort((e,m)=>{const h=e.createdAt?.toDate?.()||new Date(0);return(m.createdAt?.toDate?.()||new Date(0)).getTime()-h.getTime()})}async function T(t,a){const o=d.currentUser?.uid;if(!o)throw new Error("Usuário não autenticado");const s=f(c,"alunos",o,"planosAcao");return(await q(s,{...t,createdAt:u.now(),updatedAt:u.now()})).id}async function F(t,a){const o=d.currentUser?.uid;if(!o)throw new Error("Usuário não autenticado");const s=v(c,"alunos",o,"planosAcao",t);await y(s,{resolvido:!0,resolvidoEm:u.now(),updatedAt:u.now()})}async function k(t,a){const o=d.currentUser?.uid;if(!o)throw new Error("Usuário não autenticado");const s=v(c,"alunos",o,"planosAcao",t);await y(s,{resolvido:!1,resolvidoEm:null,updatedAt:u.now()})}function R(t,a){const o=a>=3;return t==="interpretacao"?`Fazer ${o?10:5} questões contextualizadas para praticar o conteúdo.`:`Revisar a teoria com foco na lacuna identificada e, depois, fazer ${o?20:10} questões.`}async function M(t,a,o){const s=d.currentUser?.uid;if(!s)throw new Error("Usuário não autenticado");const l=a.filter(n=>n.motivoErro==="interpretacao"||n.motivoErro==="lacuna_teorica");if(l.length===0)return;const e=f(c,"alunos",s,"planosAcao"),h=(await w(e)).docs.map(n=>({id:n.id,...n.data()})),p={};l.forEach(n=>{const r=`${t}-${n.microassunto}-${n.motivoErro}`;p[r]||(p[r]={macroassunto:n.macroassunto,microassunto:n.microassunto,motivoErro:n.motivoErro,count:0}),p[r].count++});const A=g(c);Object.entries(p).forEach(([n,r])=>{const E=h.find(i=>i.prova===t&&i.microassunto===r.microassunto&&i.motivoErro===r.motivoErro&&!i.resolvido);if(E&&E.id){const i=E.quantidadeErros+r.count,I=v(c,"alunos",s,"planosAcao",E.id);A.update(I,{quantidadeErros:i,conduta:R(r.motivoErro,i),updatedAt:u.now()})}else{const i=v(e);A.set(i,{prova:t,macroassunto:r.macroassunto,microassunto:r.microassunto,motivoErro:r.motivoErro,quantidadeErros:r.count,conduta:R(r.motivoErro,r.count),resolvido:!1,criadoManualmente:!1,createdAt:u.now(),updatedAt:u.now()})}}),await A.commit()}export{x as a,z as b,M as c,B as d,T as e,R as f,$ as g,k as h,F as r};
