import{w as h,x as E,y,z as v,J as I,e as A,T as m,G as q,F as R}from"./vendor-firebase-B70hddBE.js";import{$ as u,a0 as i}from"./index-k0fyMkYz.js";async function P(s){const t=s||u.currentUser?.uid;if(!t)throw new Error("Usuário não autenticado");const o=h(i,"alunos",t,"horarios"),a=y(o,v("diaSemana"),v("horaInicio"));return(await E(a)).docs.map(e=>({id:e.id,...e.data()}))}async function $(s,t){const o=t||u.currentUser?.uid;if(!o)throw new Error("Usuário não autenticado");const a=h(i,"alunos",o,"horarios"),e=(await E(a)).docs,l=500,w=[];e.forEach(n=>{w.push({type:"delete",ref:n.ref})}),s.forEach(n=>{const f=A(a);w.push({type:"set",ref:f,data:{...n,createdAt:m.now()}})});for(let n=0;n<w.length;n+=l){const f=I(i);w.slice(n,n+l).forEach(r=>{r.type==="delete"?f.delete(r.ref):f.set(r.ref,r.data)}),await f.commit()}}async function B(s){const t=s||u.currentUser?.uid;if(!t)throw new Error("Usuário não autenticado");const o=h(i,"alunos",t,"estudos"),a=y(o,v("data","desc"));return(await E(a)).docs.slice(0,200).map(e=>({id:e.id,...e.data()}))}async function T(s){const t=s||u.currentUser?.uid;if(!t)throw new Error("Usuário não autenticado");const o=h(i,"alunos",t,"simulados"),a=y(o,v("data","desc"));return(await E(a)).docs.slice(0,100).map(e=>({id:e.id,...e.data()}))}async function k(s){const t=s||u.currentUser?.uid;if(!t)throw new Error("Usuário não autenticado");const o=h(i,"alunos",t,"metas"),a=y(o,v("dataFim","asc"));return(await E(a)).docs.map(e=>({id:e.id,...e.data()}))}async function z(s){const t=u.currentUser?.uid;if(!t)throw new Error("Usuário não autenticado");const o=h(i,"alunos",t,"planosAcao");return(await E(o)).docs.map(e=>{const l=e.data();return{id:e.id,...l,createdAt:l.createdAt||l.criadoEm||null}}).sort((e,l)=>{const w=e.createdAt?.toDate?.()||new Date(0);return(l.createdAt?.toDate?.()||new Date(0)).getTime()-w.getTime()})}async function F(s,t){const o=u.currentUser?.uid;if(!o)throw new Error("Usuário não autenticado");const a=h(i,"alunos",o,"planosAcao");return(await q(a,{...s,createdAt:m.now(),updatedAt:m.now()})).id}async function H(s,t){const o=u.currentUser?.uid;if(!o)throw new Error("Usuário não autenticado");const a=A(i,"alunos",o,"planosAcao",s);await R(a,{resolvido:!0,resolvidoEm:m.now(),updatedAt:m.now()})}async function S(s,t){const o=u.currentUser?.uid;if(!o)throw new Error("Usuário não autenticado");const a=A(i,"alunos",o,"planosAcao",s);await R(a,{resolvido:!1,resolvidoEm:null,updatedAt:m.now()})}function D(s,t){const o=t>=3;return s==="interpretacao"?`Fazer ${o?10:5} questões contextualizadas para praticar o conteúdo.`:`Revisar a teoria com foco na lacuna identificada e, depois, fazer ${o?20:10} questões.`}async function j(s,t,o){const a=u.currentUser?.uid;if(!a)throw new Error("Usuário não autenticado");const d=t.filter(c=>c.motivoErro==="interpretacao"||c.motivoErro==="lacuna_teorica");if(d.length===0)return;const e=h(i,"alunos",a,"planosAcao"),w=(await E(e)).docs.map(c=>({id:c.id,...c.data()})),n={};d.forEach(c=>{const r=`${s}-${c.microassunto}-${c.motivoErro}`;n[r]||(n[r]={macroassunto:c.macroassunto,microassunto:c.microassunto,motivoErro:c.motivoErro,count:0}),n[r].count++});const f=I(i);Object.entries(n).forEach(([c,r])=>{const U=w.find(p=>p.prova===s&&p.microassunto===r.microassunto&&p.motivoErro===r.motivoErro&&!p.resolvido);if(U&&U.id){const p=U.quantidadeErros+r.count,g=A(i,"alunos",a,"planosAcao",U.id);f.update(g,{quantidadeErros:p,conduta:D(r.motivoErro,p),updatedAt:m.now()})}else{const p=A(e);f.set(p,{prova:s,macroassunto:r.macroassunto,microassunto:r.microassunto,motivoErro:r.motivoErro,quantidadeErros:r.count,conduta:D(r.motivoErro,r.count),resolvido:!1,criadoManualmente:!1,createdAt:m.now(),updatedAt:m.now()})}}),await f.commit()}export{T as a,k as b,j as c,z as d,F as e,D as f,B as g,S as h,$ as i,P as j,H as r};
