import{a6 as d}from"./index-CcEawOUw.js";import{e as f,h as w,w as E,y,J as m,T as i,x,j as D}from"./vendor-firebase-BLqY7lrF.js";async function A(o){try{const a=f(d,"metas_mentor",o),e=await w(a);if(!e.exists())return null;const t=e.data();return{id:e.id,alunoId:o,tempoMedioDiario:t.tempoMedioDiario,criadoEm:t.criadoEm?.toDate()||new Date,atualizadoEm:t.atualizadoEm?.toDate()||new Date,criadoPor:t.criadoPor}}catch{return null}}async function v(o,a,e){try{const t=f(d,"metas_mentor",o),n=await w(t),s={alunoId:o,tempoMedioDiario:a,atualizadoEm:i.now(),criadoPor:e};n.exists()?await D(t,s,{merge:!0}):await D(t,{...s,criadoEm:i.now()})}catch(t){throw t.code==="permission-denied"?new Error("PermissÃ£o negada. Verifique as regras do Firestore."):new Error(`Erro ao salvar meta: ${t.message}`)}}async function P(o){try{const a=await A(o);if(!a)return!1;const e=a.tempoMedioDiario.horas*60+a.tempoMedioDiario.minutos,t=new Date;t.setHours(0,0,0,0);const n=t.getDay(),s=new Date(t);s.setDate(t.getDate()-n);const r=new Date(s);r.setDate(s.getDate()-7);const c=new Date(r);c.setDate(r.getDate()+6),c.setHours(23,59,59,999);const l=E(d,"estudos"),g=y(l,m("userId","==",o),m("data",">=",i.fromDate(r)),m("data","<=",i.fromDate(c))),p=await x(g);let u=0;return p.forEach(M=>{const h=M.data();u+=h.tempoEstudo||0}),u/7<e}catch{return!1}}async function z(o){const a={};return await Promise.all(o.map(async e=>{a[e]=await P(e)})),a}function R(o,a){const e=[];return o>0&&e.push(`${o}h`),a>0&&e.push(`${a}min`),e.length>0?e.join(" "):"0min"}export{z as a,R as f,A as g,v as s};
